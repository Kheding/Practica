<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Agregar Empleado - Staff</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-light">
    <div class="container mt-5">
        <h2 class="text-center mb-4">➕ Agregar Empleado</h2>

        <form id="formEmpleado" class="row g-3 bg-white p-4 rounded shadow-sm">
            <div class="col-md-6">
                <label class="form-label">Nombre completo</label>
                <input type="text" name="nombre_completo" class="form-control" required>
            </div>

            <div class="col-md-3">
                <label class="form-label">RUT</label>
                <input type="text" name="rut" class="form-control" required>
            </div>

            <div class="col-md-3">
                <label class="form-label">Sede</label>
                <select name="sede" class="form-select" required>
                    <option value="">Seleccione una sede</option>
                    <option value="NOGALES">NOGALES</option>
                    <option value="COLON">COLON</option>
                    <option value="EL BOSQUE">EL BOSQUE</option>
                    <option value="LA CISTERNA">LA CISTERNA</option>
                    <option value="BUIN">BUIN</option>
                </select>
            </div>

            <div class="col-md-6">
                <label class="form-label">Correo Personal</label>
                <input type="email" name="email_personal" class="form-control">
            </div>

            <div class="col-md-6">
                <label class="form-label">Dirección</label>
                <input type="text" name="direccion" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label">Teléfono de contacto</label>
                <input type="text" name="fono_contacto" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label">Contacto de emergencia</label>
                <input type="text" name="contacto_emergencia" class="form-control">
            </div>

            <div class="col-md-2">
                <label class="form-label">Relación</label>
                <select name="relacion" class="form-select">
                    <option value="">Seleccione</option>
                    <option value="Esposa/o">Esposa/o</option>
                    <option value="Padre/Madre">Padre/Madre</option>
                    <option value="Hermano/a">Hermano/a</option>
                    <option value="Pareja">Pareja</option>
                    <option value="Amigo/a">Amigo/a</option>
                    <option value="Hijo/a">Hijo/a</option>
                </select>
            </div>

            <div class="col-md-2">
                <label class="form-label">Fono emergencia</label>
                <input type="text" name="fono_emergencia" class="form-control">
            </div>

            <div class="col-md-6">
                <label class="form-label">Enfermedades</label>
                <input type="text" name="enfermedades" class="form-control">
            </div>

            <div class="col-md-6">
                <label class="form-label">Alergias</label>
                <input type="text" name="Alergias" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label">Rol</label>
                <select name="rol_id" class="form-select" required>
                    <option value="">Seleccione rol</option>
                    <option value="1">Administrador</option>
                    <option value="2">Gerente de Operaciones</option>
                    <option value="3">Jefe de Operaciones</option>
                    <option value="4">Recursos Humanos</option>
                    <option value="5">Coordinador Comercial</option>
                    <option value="6">Responsable de Sede</option>
                    <option value="7">Vendedor</option>
                    <option value="8">Staff</option>
                </select>
            </div>

            <div class="col-md-4">
                <label class="form-label">Estado VD</label>
                <select name="estado_vd" class="form-select" required>
                    <option value="">Seleccione estado</option>
                    <option value="A">Activo</option>
                    <option value="I">Inactivo</option>
                </select>
            </div>

            <div class="col-md-4">
                <label class="form-label">Contraseña</label>
                <input type="password" name="clave" class="form-control" required>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success px-4">Guardar</button>
                <a href="/rrhh/dashboard" class="btn btn-secondary px-4">Cancelar</a>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('formEmpleado').addEventListener('submit', async e => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const payload = Object.fromEntries(formData.entries());

            try {
                const res = await fetch('/rrhh/nuevo', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',          // ⬅️  ENVÍA la cookie JWT
                    body: JSON.stringify(payload)
                });

                if (!res.ok) {
                    const msg = await res.text();
                    throw new Error(msg || 'Error al guardar el empleado.');
                }

                alert('✅ Empleado creado correctamente.');
                window.location.href = '/rrhh/empleados/vista';
            } catch (err) {
                alert('❌ Error: ' + err.message);
            }
        });
    </script>

</body>

</html>