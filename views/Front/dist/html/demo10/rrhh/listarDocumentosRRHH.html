<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Documentos Subidos por RRHH</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .btn-download:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <h2 class="mb-4">Documentos Subidos por Recursos Humanos</h2>

        <!-- Filtro por nombre o rut -->
        <div class="row mb-3">
            <div class="col-md-6">
                <input type="text" id="buscador" class="form-control" placeholder="Buscar por nombre o RUT...">
            </div>
        </div>

        <!-- Tabla de documentos -->
        <div class="table-responsive">
            <table class="table table-bordered bg-white">
                <thead class="table-dark">
                    <tr>
                        <th>Nombre</th>
                        <th>RUT</th>
                        <th>Rol</th>
                        <th>Documento</th>
                        <th>Tipo</th>
                        <th>Raz√≥n</th>
                        <th>Fecha</th>
                        <th>Descargar</th>
                    </tr>
                </thead>
                <tbody id="tablaRRHH"></tbody>
            </table>
        </div>

        <a href="/rrhh/dashboard" class="btn btn-secondary mt-3">Volver al Dashboard</a>
    </div>

    <script>
        let documentos = [];

        async function cargarDocumentosRRHH() {
            const res = await fetch('/rrhh/documentos/subidos'); // Nueva ruta GET para traer documentos de RRHH
            const data = await res.json();
            documentos = data.documentos;
            renderTabla();
        }

        function renderTabla() {
            const tbody = document.getElementById('tablaRRHH');
            const term = document.getElementById('buscador').value.toLowerCase();
            tbody.innerHTML = '';

            documentos
                .filter(d => 
                    d.nombre_completo.toLowerCase().includes(term) || 
                    d.rut.toLowerCase().includes(term)
                )
                .forEach(d => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${d.nombre_completo}</td>
                        <td>${d.rut}</td>
                        <td>${d.rol}</td>
                        <td>${d.nombre}</td>
                        <td>${d.tipo}</td>
                        <td>${d.razon}</td>
                        <td>${new Date(d.fecha_subida).toLocaleDateString()}</td>
                        <td><a class="btn btn-primary btn-sm btn-download" href="${d.ruta}" download>Descargar</a></td>
                    `;
                    tbody.appendChild(tr);
                });
        }

        document.getElementById('buscador').addEventListener('input', renderTabla);
        cargarDocumentosRRHH();
    </script>
</body>
</html>
